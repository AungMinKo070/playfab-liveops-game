{
    "Version": 1,
    "Revision": 3,
    "CreatedAt": "2019-07-24T20:21:14.438Z",
    "Files": [
        {
            "Filename": "main.js",
            "FileContents": "handlers.killedEnemy = function(args, context) {\n    var killStatisticName = \"kills\";\n    \n    var getResult = server.GetPlayerStatistics({\n        PlayFabId: currentPlayerId,\n        StatisticNames: [killStatisticName]\n    });\n    \n    var kills = 0;\n    if(getResult.Statistics.length > 0) {\n        kills = getResult.Statistics[0].Value;\n    }\n    kills++;\n    \n    var updateResult = server.UpdatePlayerStatistics({\n        PlayFabId: currentPlayerId,\n        Statistics: [{\n            StatisticName: killStatisticName,\n            Value: kills\n        }]\n    });\n    \n    var itemGranted = grantLoot();\n    \n    return {\n        kills: kills,\n        itemGranted: itemGranted,\n    };\n};\n\nvar grantLoot = function() {\n    var dropTableName = \"KilledEnemy\";\n    var catalogVersion = \"Main\";\n    var unpackClassName = \"unpack\";\n    var chanceToGetItem = (1/3);\n\n    var itemGranted = null;\n    \n    if(Math.random() <= chanceToGetItem) {\n        var treasure = server.EvaluateRandomResultTable({\n            CatalogVersion: catalogVersion,\n            TableId: dropTableName\n        }).ResultItemId;\n        \n        var itemGrantResult = server.GrantItemsToUser({\n            PlayFabId: currentPlayerId,\n            ItemIds: [treasure],\n            CatalogVersion: catalogVersion\n        });\n        \n        // Is this a bundle of credits we need to unpack?\n        if(itemGrantResult.ItemGrantResults[0].ItemClass.indexOf(unpackClassName) !== -1) {\n            server.ConsumeItem({\n                PlayFabId: currentPlayerId,\n                ConsumeCount: 1,\n                ItemInstanceId: itemGrantResult.ItemGrantResults[0].ItemInstanceId\n            });\n        }\n        \n        itemGranted = itemGrantResult.ItemGrantResults[0].ItemId;\n    }\n    \n    return itemGranted;\n};"
        }
    ],
    "IsPublished": true
}